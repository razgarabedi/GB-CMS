<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Digital Signage Admin</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .material-icons { font-family: 'Material Icons'; font-weight: normal; font-style: normal; }
        .line-clamp-1 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 1; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useCallback, useEffect, useMemo } = React;

        // ============================================================================
        // TYPES AND INTERFACES
        // ============================================================================

        const AdminTab = {
            DESIGN: 'design',
            COMPONENTS: 'components', 
            TEMPLATES: 'templates',
            PLUGINS: 'plugins',
            PREVIEW: 'preview',
            SETTINGS: 'settings',
            HELP: 'help'
        };

        // ============================================================================
        // API SERVICE
        // ============================================================================

        // Helper function for API calls
        const apiCall = async (endpoint, options = {}) => {
            const url = `/api/admin${endpoint}`;
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers,
            };

            console.log(`🔗 API Call: ${options.method || 'GET'} ${url}`);

            try {
                const response = await fetch(url, {
                    ...options,
                    headers,
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    let error;
                    try {
                        error = JSON.parse(errorText);
                    } catch {
                        error = { error: errorText || 'Unknown error' };
                    }
                    throw new Error(error.error || `HTTP ${response.status}`);
                }

                const data = await response.json();
                console.log(`✅ API Success:`, data);
                return data;
            } catch (error) {
                console.error(`❌ API call failed: ${endpoint}`, error);
                throw error;
            }
        };

        const AdminAPI = {
            components: {
                async getAll() { return apiCall('/components'); },
                async getById(id) { return apiCall(`/components/${id}`); },
                async save(component) { return apiCall('/components', { method: 'POST', body: JSON.stringify(component) }); },
                async delete(id) { return apiCall(`/components/${id}`, { method: 'DELETE' }); }
            },

            templates: {
                async getAll() { return apiCall('/templates'); },
                async getById(id) { return apiCall(`/templates/${id}`); },
                async save(template) { return apiCall('/templates', { method: 'POST', body: JSON.stringify(template) }); },
                async delete(id) { return apiCall(`/templates/${id}`, { method: 'DELETE' }); }
            },

            plugins: {
                async getAll() { return apiCall('/plugins'); },
                async getById(id) { return apiCall(`/plugins/${id}`); },
                async install(id) { return apiCall(`/plugins/${id}/install`, { method: 'POST' }); },
                async uninstall(id) { return apiCall(`/plugins/${id}/uninstall`, { method: 'POST' }); }
            },

            layouts: {
                async getAll() { return apiCall('/layouts'); },
                async getById(id) { return apiCall(`/layouts/${id}`); },
                async save(layout) { return apiCall('/layouts', { method: 'POST', body: JSON.stringify(layout) }); },
                async delete(id) { return apiCall(`/layouts/${id}`, { method: 'DELETE' }); }
            },

            configs: {
                async getAll() { return apiCall('/configs'); },
                async getByScreenId(screenId) { return apiCall(`/configs/${screenId}`); },
                async save(screenId, config) { return apiCall(`/configs/${screenId}`, { method: 'POST', body: JSON.stringify(config) }); }
            },

            analytics: {
                async getAnalytics() { return apiCall('/analytics'); },
                async getHealth() { return apiCall('/health'); }
            }
        };

        // ============================================================================
        // COMPONENT LIBRARY
        // ============================================================================

        const ComponentLibrary = ({ library, onLibraryChange, onDragStart, onDragEnd }) => {
            const [searchQuery, setSearchQuery] = useState(library.searchQuery || '');
            const [selectedCategory, setSelectedCategory] = useState(library.selectedCategory || 'all');
            const [sortBy, setSortBy] = useState(library.sortBy || 'name');
            const [showFilters, setShowFilters] = useState(false);

            const renderIcon = (icon) => {
                switch (icon.type) {
                    case 'material':
                        return <span className="material-icons text-sm">{icon.name}</span>;
                    case 'fontawesome':
                        return <i className={`fa fa-${icon.name} text-xs`}></i>;
                    case 'svg':
                        return <div className="w-4 h-4" dangerouslySetInnerHTML={{ __html: icon.data || '' }} />;
                    case 'custom':
                        return <span className="text-sm">{icon.data}</span>;
                    default:
                        return <div className="w-4 h-4 bg-gray-400 rounded"></div>;
                }
            };

            const renderComponentItem = (item) => {
                const isDisabled = item.status === 'disabled' || item.status === 'error';
                
                return (
                    <div
                        key={item.id}
                        className={`p-2 border border-gray-600 rounded cursor-move transition-all duration-200 ${
                            isDisabled 
                                ? 'opacity-50 cursor-not-allowed bg-gray-800' 
                                : 'hover:border-blue-400 hover:bg-gray-800 bg-gray-900'
                        }`}
                        draggable={!isDisabled}
                        onDragStart={(e) => !isDisabled && onDragStart(e, item)}
                        onDragEnd={onDragEnd}
                    >
                        <div className="flex items-start space-x-2">
                            <div className="flex-shrink-0 text-blue-400">
                                {renderIcon(item.icon)}
                            </div>
                            
                            <div className="flex-1 min-w-0">
                                <div className="flex items-center justify-between">
                                    <h4 className="text-xs font-medium text-white truncate">
                                        {item.name}
                                    </h4>
                                    {item.isPlugin && (
                                        <span className="inline-flex items-center px-1 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800">
                                            Plugin
                                        </span>
                                    )}
                                </div>
                                
                                <p className="text-xs text-gray-400 mt-1 line-clamp-1">
                                    {item.description}
                                </p>
                                
                                <div className="flex items-center justify-between mt-2">
                                    <div className="flex flex-wrap gap-1">
                                        {item.tags.slice(0, 2).map(tag => (
                                            <span
                                                key={tag}
                                                className="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-gray-700 text-gray-300"
                                            >
                                                {tag}
                                            </span>
                                        ))}
                                        {item.tags.length > 2 && (
                                            <span className="text-xs text-gray-500">
                                                +{item.tags.length - 2}
                                            </span>
                                        )}
                                    </div>
                                    
                                    <div className="flex items-center space-x-1">
                                        {item.status === 'installing' && (
                                            <div className="w-3 h-3 border-2 border-blue-400 border-t-transparent rounded-full animate-spin"></div>
                                        )}
                                        {item.status === 'error' && (
                                            <span className="text-red-400 text-xs">Error</span>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const filteredComponents = useMemo(() => {
                let filtered = library.items || [];

                if (searchQuery.trim()) {
                    const query = searchQuery.toLowerCase();
                    filtered = filtered.filter(item => 
                        item.name.toLowerCase().includes(query) ||
                        item.description.toLowerCase().includes(query) ||
                        item.tags.some(tag => tag.toLowerCase().includes(query))
                    );
                }

                if (selectedCategory !== 'all') {
                    filtered = filtered.filter(item => item.category === selectedCategory);
                }

                filtered.sort((a, b) => {
                    switch (sortBy) {
                        case 'name':
                            return a.name.localeCompare(b.name);
                        case 'category':
                            return a.category.localeCompare(b.category);
                        default:
                            return 0;
                    }
                });

                return filtered;
            }, [library.items, searchQuery, selectedCategory, sortBy]);

            const groupedComponents = useMemo(() => {
                const groups = {};
                filteredComponents.forEach(component => {
                    const category = component.category;
                    if (!groups[category]) {
                        groups[category] = [];
                    }
                    groups[category].push(component);
                });
                return groups;
            }, [filteredComponents]);

            const renderCategorySection = (category, items) => {
                const categoryLabels = {
                    widget: 'Widgets',
                    layout: 'Layouts',
                    utility: 'Utilities',
                    service: 'Services',
                    theme: 'Themes',
                    integration: 'Integrations',
                    custom: 'Custom',
                    plugin: 'Plugins'
                };

                return (
                    <div key={category} className="mb-6">
                        <h3 className="text-sm font-medium text-gray-300 mb-3 flex items-center">
                            {categoryLabels[category] || category}
                            <span className="ml-2 px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded-full">
                                {items.length}
                            </span>
                        </h3>
                        
                        <div className="space-y-2">
                            {items.map(renderComponentItem)}
                        </div>
                    </div>
                );
            };

            return (
                <div className="bg-gray-800 border border-gray-700 rounded-lg flex flex-col h-full">
                    {/* Header */}
                    <div className="p-2 border-b border-gray-700">
                        <h2 className="text-sm font-semibold text-white mb-2">Component Library</h2>
                        
                        {/* Search */}
                        <div className="relative mb-3">
                            <input
                                type="text"
                                placeholder="Search components..."
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                                className="w-full px-2 py-1 pl-8 bg-gray-900 border border-gray-600 rounded text-white placeholder-gray-400 focus:outline-none focus:border-blue-400 text-sm"
                            />
                            <div className="absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none">
                                <svg className="h-3 w-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>
                        </div>

                        {/* Category Filter */}
                        <div className="flex flex-wrap gap-1 mb-2">
                            <button
                                onClick={() => setSelectedCategory('all')}
                                className={`px-2 py-1 text-xs rounded transition-colors ${
                                    selectedCategory === 'all'
                                        ? 'bg-blue-500 text-white'
                                        : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                }`}
                            >
                                All
                            </button>
                            {(library.categories || []).map(category => (
                                <button
                                    key={category}
                                    onClick={() => setSelectedCategory(category)}
                                    className={`px-2 py-1 text-xs rounded transition-colors ${
                                        selectedCategory === category
                                            ? 'bg-blue-500 text-white'
                                            : 'bg-gray-700 text-gray-300 hover:bg-gray-600'
                                    }`}
                                >
                                    {category}
                                </button>
                            ))}
                        </div>

                        {/* Sort */}
                        <div className="flex items-center justify-between">
                            <select
                                value={sortBy}
                                onChange={(e) => setSortBy(e.target.value)}
                                className="px-1 py-1 text-xs bg-gray-900 border border-gray-600 rounded text-white"
                            >
                                <option value="name">Name</option>
                                <option value="category">Category</option>
                            </select>
                        </div>
                    </div>

                    {/* Components List */}
                    <div className="flex-1 overflow-y-auto p-2">
                        {Object.keys(groupedComponents).length === 0 ? (
                            <div className="text-center text-gray-400 py-8">
                                <svg className="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.29-1.009-5.824-2.709M15 6.291A7.962 7.962 0 0012 5c-2.34 0-4.29 1.009-5.824 2.709" />
                                </svg>
                                <p className="text-sm">No components found</p>
                                <p className="text-xs text-gray-500 mt-1">
                                    Try adjusting your search or filters
                                </p>
                            </div>
                        ) : (
                            <div>
                                {Object.entries(groupedComponents).map(([category, items]) =>
                                    renderCategorySection(category, items)
                                )}
                            </div>
                        )}
                    </div>

                    {/* Footer */}
                    <div className="p-2 border-t border-gray-700 bg-gray-900">
                        <div className="text-xs text-gray-400 text-center">
                            {filteredComponents.length} of {(library.items || []).length} components
                        </div>
                    </div>
                </div>
            );
        };

        // ============================================================================
        // MAIN ADMIN INTERFACE
        // ============================================================================

        const AdminInterface = () => {
            const [currentTab, setCurrentTab] = useState(AdminTab.DESIGN);
            const [components, setComponents] = useState([]);
            const [templates, setTemplates] = useState([]);
            const [plugins, setPlugins] = useState([]);
            const [layouts, setLayouts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [showLeftSidebar, setShowLeftSidebar] = useState(true);
            const [showRightSidebar, setShowRightSidebar] = useState(true);
            const [canvasComponents, setCanvasComponents] = useState([]);
            const [selectedComponent, setSelectedComponent] = useState(null);
            const [isDragOver, setIsDragOver] = useState(false);

            // Load data on mount
            useEffect(() => {
                const loadData = async () => {
                    try {
                        setLoading(true);
                        setError(null);
                        
                        const [componentsData, templatesData, pluginsData, layoutsData] = await Promise.all([
                            AdminAPI.components.getAll().catch(() => []),
                            AdminAPI.templates.getAll().catch(() => []),
                            AdminAPI.plugins.getAll().catch(() => []),
                            AdminAPI.layouts.getAll().catch(() => [])
                        ]);
                        
                        setComponents(componentsData);
                        setTemplates(templatesData);
                        setPlugins(pluginsData);
                        setLayouts(layoutsData);
                    } catch (err) {
                        console.error('Failed to load data:', err);
                        setError(err.message);
                    } finally {
                        setLoading(false);
                    }
                };

                loadData();
            }, []);

            const handleDragStart = useCallback((e, item) => {
                console.log('Drag start:', item);
                e.dataTransfer.setData('application/json', JSON.stringify(item));
                e.dataTransfer.effectAllowed = 'copy';
                
                // Set drag image
                const dragImage = e.currentTarget.cloneNode(true);
                dragImage.style.transform = 'rotate(5deg)';
                dragImage.style.opacity = '0.8';
                dragImage.style.position = 'absolute';
                dragImage.style.top = '-1000px';
                document.body.appendChild(dragImage);
                e.dataTransfer.setDragImage(dragImage, 0, 0);
                
                setTimeout(() => {
                    if (document.body.contains(dragImage)) {
                        document.body.removeChild(dragImage);
                    }
                }, 0);
            }, []);

            const handleDragEnd = useCallback(() => {
                console.log('Drag end');
            }, []);

            const handleCanvasDragOver = useCallback((e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
                setIsDragOver(true);
            }, []);

            const handleCanvasDragLeave = useCallback((e) => {
                // Only set drag over to false if we're leaving the canvas area
                if (!e.currentTarget.contains(e.relatedTarget)) {
                    setIsDragOver(false);
                }
            }, []);

            const handleCanvasDrop = useCallback((e) => {
                e.preventDefault();
                setIsDragOver(false);
                try {
                    const itemData = e.dataTransfer.getData('application/json');
                    if (itemData) {
                        const item = JSON.parse(itemData);
                        console.log('Dropped item:', item);
                        
                        // Create a new component instance for the canvas
                        const newComponent = {
                            id: `${item.id}-${Date.now()}`,
                            type: item.id,
                            name: item.name,
                            x: e.nativeEvent.offsetX - 50, // Center the component
                            y: e.nativeEvent.offsetY - 25,
                            width: 100,
                            height: 50,
                            props: { ...item.defaultProps },
                            originalItem: item
                        };
                        
                        setCanvasComponents(prev => [...prev, newComponent]);
                        setSelectedComponent(newComponent);
                    }
                } catch (error) {
                    console.error('Error handling drop:', error);
                }
            }, []);

            const handleComponentClick = useCallback((component) => {
                setSelectedComponent(component);
            }, []);

            const handleComponentMove = useCallback((componentId, newX, newY) => {
                setCanvasComponents(prev => 
                    prev.map(comp => 
                        comp.id === componentId 
                            ? { ...comp, x: newX, y: newY }
                            : comp
                    )
                );
            }, []);

            const handleComponentDelete = useCallback((componentId) => {
                setCanvasComponents(prev => prev.filter(comp => comp.id !== componentId));
                if (selectedComponent && selectedComponent.id === componentId) {
                    setSelectedComponent(null);
                }
            }, [selectedComponent]);

            const renderHeader = () => (
                <header className="bg-gray-800 border-b border-gray-700 px-4 py-2">
                    <div className="flex items-center justify-between">
                        <div className="flex items-center space-x-3">
                            <h1 className="text-lg font-bold text-white">Advanced Digital Signage Admin</h1>
                            <div className="flex items-center space-x-2">
                                <span className="text-xs text-gray-400">Server Admin</span>
                            </div>
                        </div>
                        
                        <div className="flex items-center space-x-3">
                            <button
                                onClick={() => window.location.reload()}
                                className="px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors"
                            >
                                Refresh
                            </button>
                        </div>
                    </div>
                </header>
            );

            const renderNavigation = () => {
                const tabs = [
                    { id: AdminTab.DESIGN, label: 'Design', icon: '🎨' },
                    { id: AdminTab.COMPONENTS, label: 'Components', icon: '🧩' },
                    { id: AdminTab.TEMPLATES, label: 'Templates', icon: '📋' },
                    { id: AdminTab.PLUGINS, label: 'Plugins', icon: '🔌' },
                    { id: AdminTab.PREVIEW, label: 'Preview', icon: '👁️' },
                    { id: AdminTab.SETTINGS, label: 'Settings', icon: '⚙️' },
                    { id: AdminTab.HELP, label: 'Help', icon: '❓' }
                ];

                return (
                    <nav className="bg-gray-800 border-b border-gray-700">
                        <div className="flex items-center justify-between px-4 py-1">
                            <div className="flex space-x-0.5 overflow-x-auto">
                                {tabs.map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setCurrentTab(tab.id)}
                                        className={`flex items-center space-x-1 px-2 py-1.5 text-xs font-medium rounded transition-colors whitespace-nowrap ${
                                            currentTab === tab.id
                                                ? 'bg-blue-500 text-white'
                                                : 'text-gray-400 hover:text-white hover:bg-gray-700'
                                        }`}
                                    >
                                        <span className="text-xs">{tab.icon}</span>
                                        <span className="hidden sm:inline">{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>
                );
            };

            const renderMainContent = () => {
                if (loading) {
                    return (
                        <div className="h-full flex items-center justify-center">
                            <div className="text-center">
                                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                                <p className="text-lg text-white">Loading admin interface...</p>
                            </div>
                        </div>
                    );
                }

                if (error) {
                    return (
                        <div className="h-full flex items-center justify-center">
                            <div className="text-center">
                                <div className="text-red-500 text-4xl mb-4">⚠️</div>
                                <p className="text-lg text-white mb-2">Failed to load admin interface</p>
                                <p className="text-sm text-gray-400 mb-4">{error}</p>
                                <div className="space-x-2">
                                    <button
                                        onClick={() => window.location.reload()}
                                        className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"
                                    >
                                        Retry
                                    </button>
                                    <button
                                        onClick={() => {
                                            setError(null);
                                            setLoading(false);
                                        }}
                                        className="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition-colors"
                                    >
                                        Continue Anyway
                                    </button>
                                </div>
                            </div>
                        </div>
                    );
                }

                switch (currentTab) {
                    case AdminTab.DESIGN:
                        return (
                            <div className="flex h-full">
                                {/* Left Sidebar - Component Library */}
                                {showLeftSidebar && (
                                    <div className="w-64 lg:w-80 border-r border-gray-700">
                                        <div className="flex items-center justify-between p-2 border-b border-gray-700">
                                            <h3 className="text-sm font-medium text-white">Components</h3>
                                            <button
                                                onClick={() => setShowLeftSidebar(false)}
                                                className="text-gray-400 hover:text-white text-xs"
                                            >
                                                ✕
                                            </button>
                                        </div>
                                        <ComponentLibrary
                                            library={{
                                                items: components,
                                                categories: ['widget', 'layout', 'utility', 'service', 'theme', 'integration', 'custom', 'plugin'],
                                                searchQuery: '',
                                                selectedCategory: 'all',
                                                sortBy: 'name',
                                                filterBy: { tags: [], status: [], isPlugin: null }
                                            }}
                                            onLibraryChange={() => {}}
                                            onDragStart={handleDragStart}
                                            onDragEnd={handleDragEnd}
                                        />
                                    </div>
                                )}
                                
                                {/* Main Canvas Area */}
                                <div className="flex-1 flex flex-col">
                                    {/* Canvas Toolbar */}
                                    <div className="flex items-center justify-between p-2 border-b border-gray-700">
                                        <div className="flex items-center space-x-2">
                                            {!showLeftSidebar && (
                                                <button
                                                    onClick={() => setShowLeftSidebar(true)}
                                                    className="px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700"
                                                >
                                                    Components
                                                </button>
                                            )}
                                            <span className="text-xs text-gray-400">Canvas</span>
                                            <span className="text-xs text-gray-500">({canvasComponents.length} components)</span>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            {canvasComponents.length > 0 && (
                                                <button
                                                    onClick={() => {
                                                        setCanvasComponents([]);
                                                        setSelectedComponent(null);
                                                    }}
                                                    className="px-2 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700"
                                                >
                                                    Clear All
                                                </button>
                                            )}
                                            {!showRightSidebar && (
                                                <button
                                                    onClick={() => setShowRightSidebar(true)}
                                                    className="px-2 py-1 text-xs bg-gray-600 text-white rounded hover:bg-gray-700"
                                                >
                                                    Properties
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* Canvas */}
                                    <div className="flex-1 bg-gray-800 border border-gray-600 rounded-lg m-2">
                                        <div className="p-4">
                                            <h3 className="text-lg font-semibold text-white mb-4">Layout Canvas</h3>
                                            <div 
                                                className={`bg-gray-900 border border-gray-700 rounded-lg p-8 min-h-96 relative transition-colors ${
                                                    isDragOver ? 'border-blue-400 bg-blue-900 bg-opacity-20' : ''
                                                }`}
                                                onDragOver={handleCanvasDragOver}
                                                onDragLeave={handleCanvasDragLeave}
                                                onDrop={handleCanvasDrop}
                                                style={{ minHeight: '400px' }}
                                            >
                                                {isDragOver && (
                                                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-10">
                                                        <div className="text-center text-blue-400">
                                                            <div className="text-6xl mb-4">📦</div>
                                                            <p className="text-lg font-semibold">Drop component here</p>
                                                        </div>
                                                    </div>
                                                )}
                                                {canvasComponents.length === 0 && !isDragOver ? (
                                                    <div className="absolute inset-0 flex items-center justify-center">
                                                        <div className="text-center text-gray-400">
                                                            <div className="text-4xl mb-4">🎨</div>
                                                            <p className="text-lg mb-2">Drag components here to build your layout</p>
                                                            <p className="text-sm">Use the Components panel to add widgets</p>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    canvasComponents.map(component => (
                                                        <div
                                                            key={component.id}
                                                            className={`absolute border-2 rounded cursor-move p-2 bg-blue-600 text-white text-xs ${
                                                                selectedComponent && selectedComponent.id === component.id
                                                                    ? 'border-yellow-400 shadow-lg'
                                                                    : 'border-blue-400 hover:border-blue-300'
                                                            }`}
                                                            style={{
                                                                left: component.x,
                                                                top: component.y,
                                                                width: component.width,
                                                                height: component.height,
                                                                minWidth: '80px',
                                                                minHeight: '30px'
                                                            }}
                                                            onClick={() => handleComponentClick(component)}
                                                            draggable
                                                            onDragStart={(e) => {
                                                                e.dataTransfer.setData('application/json', JSON.stringify(component));
                                                            }}
                                                            onDragEnd={(e) => {
                                                                const rect = e.currentTarget.parentElement.getBoundingClientRect();
                                                                const newX = e.clientX - rect.left - component.width / 2;
                                                                const newY = e.clientY - rect.top - component.height / 2;
                                                                
                                                                // Keep component within canvas bounds
                                                                const boundedX = Math.max(0, Math.min(newX, rect.width - component.width));
                                                                const boundedY = Math.max(0, Math.min(newY, rect.height - component.height));
                                                                
                                                                handleComponentMove(component.id, boundedX, boundedY);
                                                            }}
                                                        >
                                                            <div className="flex items-center justify-between">
                                                                <span className="truncate">{component.name}</span>
                                                                <button
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        handleComponentDelete(component.id);
                                                                    }}
                                                                    className="ml-2 text-red-300 hover:text-red-100"
                                                                >
                                                                    ×
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Right Sidebar - Properties Panel */}
                                {showRightSidebar && (
                                    <div className="w-64 lg:w-80 border-l border-gray-700">
                                        <div className="flex items-center justify-between p-2 border-b border-gray-700">
                                            <h3 className="text-sm font-medium text-white">Properties</h3>
                                            <button
                                                onClick={() => setShowRightSidebar(false)}
                                                className="text-gray-400 hover:text-white text-xs"
                                            >
                                                ✕
                                            </button>
                                        </div>
                                        <div className="p-4">
                                            {selectedComponent ? (
                                                <div>
                                                    <h4 className="text-sm font-medium text-white mb-3">
                                                        {selectedComponent.name} Properties
                                                    </h4>
                                                    <div className="space-y-3">
                                                        <div>
                                                            <label className="block text-xs text-gray-400 mb-1">Position</label>
                                                            <div className="grid grid-cols-2 gap-2">
                                                                <input
                                                                    type="number"
                                                                    value={selectedComponent.x}
                                                                    onChange={(e) => handleComponentMove(selectedComponent.id, parseInt(e.target.value) || 0, selectedComponent.y)}
                                                                    className="w-full px-2 py-1 text-xs bg-gray-900 border border-gray-600 rounded text-white"
                                                                    placeholder="X"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={selectedComponent.y}
                                                                    onChange={(e) => handleComponentMove(selectedComponent.id, selectedComponent.x, parseInt(e.target.value) || 0)}
                                                                    className="w-full px-2 py-1 text-xs bg-gray-900 border border-gray-600 rounded text-white"
                                                                    placeholder="Y"
                                                                />
                                                            </div>
                                                        </div>
                                                        <div>
                                                            <label className="block text-xs text-gray-400 mb-1">Size</label>
                                                            <div className="grid grid-cols-2 gap-2">
                                                                <input
                                                                    type="number"
                                                                    value={selectedComponent.width}
                                                                    onChange={(e) => {
                                                                        const newWidth = parseInt(e.target.value) || 100;
                                                                        setCanvasComponents(prev => 
                                                                            prev.map(comp => 
                                                                                comp.id === selectedComponent.id 
                                                                                    ? { ...comp, width: newWidth }
                                                                                    : comp
                                                                            )
                                                                        );
                                                                    }}
                                                                    className="w-full px-2 py-1 text-xs bg-gray-900 border border-gray-600 rounded text-white"
                                                                    placeholder="Width"
                                                                />
                                                                <input
                                                                    type="number"
                                                                    value={selectedComponent.height}
                                                                    onChange={(e) => {
                                                                        const newHeight = parseInt(e.target.value) || 50;
                                                                        setCanvasComponents(prev => 
                                                                            prev.map(comp => 
                                                                                comp.id === selectedComponent.id 
                                                                                    ? { ...comp, height: newHeight }
                                                                                    : comp
                                                                            )
                                                                        );
                                                                    }}
                                                                    className="w-full px-2 py-1 text-xs bg-gray-900 border border-gray-600 rounded text-white"
                                                                    placeholder="Height"
                                                                />
                                                            </div>
                                                        </div>
                                                        {selectedComponent.originalItem && selectedComponent.originalItem.propsSchema && (
                                                            <div>
                                                                <label className="block text-xs text-gray-400 mb-1">Component Properties</label>
                                                                <div className="space-y-2">
                                                                    {Object.entries(selectedComponent.originalItem.propsSchema.properties || {}).map(([key, prop]) => (
                                                                        <div key={key}>
                                                                            <label className="block text-xs text-gray-300 mb-1">{key}</label>
                                                                            {prop.type === 'boolean' ? (
                                                                                <div>
                                                                                    <input
                                                                                        type="checkbox"
                                                                                        checked={selectedComponent.props[key] || false}
                                                                                        onChange={(e) => {
                                                                                            setCanvasComponents(prev => 
                                                                                                prev.map(comp => 
                                                                                                    comp.id === selectedComponent.id 
                                                                                                        ? { ...comp, props: { ...comp.props, [key]: e.target.checked } }
                                                                                                        : comp
                                                                                                )
                                                                                            );
                                                                                        }}
                                                                                        className="mr-2"
                                                                                    />
                                                                                </div>
                                                                            ) : (
                                                                                <input
                                                                                    type={prop.type === 'number' ? 'number' : 'text'}
                                                                                    value={selectedComponent.props[key] || prop.default || ''}
                                                                                    onChange={(e) => {
                                                                                        const value = prop.type === 'number' ? parseFloat(e.target.value) || 0 : e.target.value;
                                                                                        setCanvasComponents(prev => 
                                                                                            prev.map(comp => 
                                                                                                comp.id === selectedComponent.id 
                                                                                                    ? { ...comp, props: { ...comp.props, [key]: value } }
                                                                                                    : comp
                                                                                            )
                                                                                        );
                                                                                    }}
                                                                                    className="w-full px-2 py-1 text-xs bg-gray-900 border border-gray-600 rounded text-white"
                                                                                    placeholder={prop.default || ''}
                                                                                />
                                                                            )}
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        )}
                                                        <button
                                                            onClick={() => handleComponentDelete(selectedComponent.id)}
                                                            className="w-full px-3 py-2 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors"
                                                        >
                                                            Delete Component
                                                        </button>
                                                    </div>
                                                </div>
                                            ) : (
                                                <p className="text-sm text-gray-400">Select a component to edit its properties</p>
                                            )}
                                        </div>
                                    </div>
                                )}
                            </div>
                        );

                    case AdminTab.COMPONENTS:
                        return (
                            <div className="h-full p-2">
                                <div className="max-w-6xl mx-auto">
                                    <h2 className="text-lg font-bold text-white mb-3">Component Library</h2>
                                    <div className="bg-gray-800 border border-gray-700 rounded-lg">
                                        <ComponentLibrary
                                            library={{
                                                items: components,
                                                categories: ['widget', 'layout', 'utility', 'service', 'theme', 'integration', 'custom', 'plugin'],
                                                searchQuery: '',
                                                selectedCategory: 'all',
                                                sortBy: 'name',
                                                filterBy: { tags: [], status: [], isPlugin: null }
                                            }}
                                            onLibraryChange={() => {}}
                                            onDragStart={handleDragStart}
                                            onDragEnd={handleDragEnd}
                                        />
                                    </div>
                                </div>
                            </div>
                        );

                    case AdminTab.TEMPLATES:
                        return (
                            <div className="h-full p-6">
                                <div className="max-w-6xl mx-auto">
                                    <h2 className="text-2xl font-bold text-white mb-6">Template Manager</h2>
                                    <div className="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                        <p className="text-gray-400">Templates: {templates.length}</p>
                                        <p className="text-sm text-gray-500 mt-2">Template management interface coming soon...</p>
                                    </div>
                                </div>
                            </div>
                        );

                    case AdminTab.PLUGINS:
                        return (
                            <div className="h-full p-6">
                                <div className="max-w-6xl mx-auto">
                                    <h2 className="text-2xl font-bold text-white mb-6">Plugin Manager</h2>
                                    <div className="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                        <p className="text-gray-400">Plugins: {plugins.length}</p>
                                        <p className="text-sm text-gray-500 mt-2">Plugin management interface coming soon...</p>
                                    </div>
                                </div>
                            </div>
                        );

                    case AdminTab.PREVIEW:
                        return (
                            <div className="h-full p-6">
                                <div className="max-w-6xl mx-auto">
                                    <h2 className="text-2xl font-bold text-white mb-6">Preview System</h2>
                                    <div className="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                        <p className="text-gray-400">Preview system coming soon...</p>
                                    </div>
                                </div>
                            </div>
                        );

                    case AdminTab.SETTINGS:
                        return (
                            <div className="p-6">
                                <div className="max-w-4xl mx-auto">
                                    <h2 className="text-2xl font-bold text-white mb-6">Settings</h2>
                                    <div className="space-y-6">
                                        <div className="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                            <h3 className="text-lg font-semibold text-white mb-4">System Information</h3>
                                            <div className="space-y-2 text-sm">
                                                <p><span className="text-gray-400">Components:</span> {components.length}</p>
                                                <p><span className="text-gray-400">Templates:</span> {templates.length}</p>
                                                <p><span className="text-gray-400">Plugins:</span> {plugins.length}</p>
                                                <p><span className="text-gray-400">Layouts:</span> {layouts.length}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );

                    case AdminTab.HELP:
                        return (
                            <div className="p-6">
                                <div className="max-w-4xl mx-auto">
                                    <h2 className="text-2xl font-bold text-white mb-6">Help & Documentation</h2>
                                    <div className="space-y-6">
                                        <div className="bg-gray-800 border border-gray-700 rounded-lg p-6">
                                            <h3 className="text-lg font-semibold text-white mb-4">Getting Started</h3>
                                            <div className="space-y-4 text-sm text-gray-300">
                                                <p>Welcome to the Advanced Digital Signage Admin Interface!</p>
                                                <p>This interface provides comprehensive tools for managing your digital signage system.</p>
                                                <ul className="list-disc list-inside space-y-2">
                                                    <li>Use the <strong>Design</strong> tab to create layouts with drag-and-drop</li>
                                                    <li>Browse and manage components in the <strong>Components</strong> tab</li>
                                                    <li>Save and load templates in the <strong>Templates</strong> tab</li>
                                                    <li>Install and manage plugins in the <strong>Plugins</strong> tab</li>
                                                    <li>Preview your designs in real-time in the <strong>Preview</strong> tab</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );

                    default:
                        return (
                            <div className="h-full p-6">
                                <div className="max-w-4xl mx-auto">
                                    <div className="bg-gray-800 border border-gray-700 rounded-lg p-12 text-center">
                                        <div className="text-4xl mb-6">🎯</div>
                                        <h2 className="text-2xl font-bold text-white mb-4">Welcome to Advanced Digital Signage Admin</h2>
                                        <p className="text-lg text-gray-300 mb-6">Select a tab from the navigation above to get started</p>
                                    </div>
                                </div>
                            </div>
                        );
                }
            };

            return (
                <div className="bg-gray-900 text-white flex flex-col h-screen">
                    {renderHeader()}
                    {renderNavigation()}
                    <main className="flex-1 overflow-hidden">
                        {renderMainContent()}
                    </main>
                </div>
            );
        };

        // ============================================================================
        // RENDER APP
        // ============================================================================

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminInterface />);
    </script>
</body>
</html>
